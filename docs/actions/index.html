<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.98.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Actions #  You can probably find yourself in a situation where some part of the packit workflow needs to be tweaked for your package.
Packit supports actions, which can be used to change the default implementation of some steps in the workflow. Packit is able to execute multiple commands for a single action. Each action accepts a list of commands. By default, the commands are executed using python&rsquo;s subprocess module without shell.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Actions" />
<meta property="og:description" content="Actions #  You can probably find yourself in a situation where some part of the packit workflow needs to be tweaked for your package.
Packit supports actions, which can be used to change the default implementation of some steps in the workflow. Packit is able to execute multiple commands for a single action. Each action accepts a list of commands. By default, the commands are executed using python&rsquo;s subprocess module without shell." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://packit.dev/docs/actions/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2019-06-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-06-28T00:00:00+00:00" />

<title>Actions | Packit</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.ece3f56fc3f716f87ccd4e6f3ea44ba1fa6757114261dadfbf861fde7d4e6203.css" integrity="sha256-7OP1b8P3Fvh8zU5vPqRLofpnVxFCYdrfv4Yf3n1OYgM=">
<script defer src="/en.search.min.2d116d6280cc21c4d2dcffda82bc8e64969fd4aaddf4d7a55afd4e980c891d79.js" integrity="sha256-LRFtYoDMIcTS3P/agryOZJaf1Krd9NelWv1OmAyJHXk="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/packit_logo.png" alt="Logo" /><span>Packit</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>






  
<ul>
  
  <li>
    <a href="https://dashboard.packit.dev" target="_blank" rel="noopener">
        Dashboard
      </a>
  </li>
  
</ul>







  

  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2f67fdc9a362fd86f1cfd4450ed56551" class="toggle" checked />
    <label for="section-2f67fdc9a362fd86f1cfd4450ed56551" class="flex justify-between">
      <a href="https://packit.dev/docs/" class="">User Documentation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/about/" class="">About Packit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/guide/" class="">Packit Onboarding Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/testing-farm/" class="">Testing Farm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/faq/" class="">FAQ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/configuration/" class="">Configuration</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/configuration/examples/" class="">Examples</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-17ea62a3fa80e270b55a640146bc89e1" class="toggle"  />
    <label for="section-17ea62a3fa80e270b55a640146bc89e1" class="flex justify-between">
      <a href="https://packit.dev/docs/cli/" class="">Packit CLI</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/init/" class="">init</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/create-update/" class="">create-update</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/propose-downstream/" class="">propose-downstream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/srpm/" class="">srpm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/prepare-sources/" class="">prepare-sources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/sync-from-downstream/" class="">sync-from-downstream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/status/" class="">status</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/push-updates/" class="">push-updates</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/validate-config/" class="">validate-config</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0b0c82992a6a45cfdc1765cc6064bbd2" class="toggle"  />
    <label for="section-0b0c82992a6a45cfdc1765cc6064bbd2" class="flex justify-between">
      <a href="https://packit.dev/docs/cli/build/" class="">build</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/build/koji/" class="">in-koji</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/build/in-image-builder/" class="">in-image-builder</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/build/mock/" class="">in-mock</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/build/local/" class="">locally</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/build/copr/" class="">in-copr</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a024048a4317a88a547d3a91b2359da1" class="toggle"  />
    <label for="section-a024048a4317a88a547d3a91b2359da1" class="flex justify-between">
      <a  class="">source-git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/source-git/init/" class="">init</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/source-git/status/" class="">status</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/source-git/update-dist-git/" class="">update-dist-git</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/cli/source-git/update-source-git/" class="">update-source-git</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/actions/" class=" active">Actions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/fedora-releases-guide/" class="">How to do Fedora releases with Packit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/service-level-objectives/" class="">Service Level Objectives</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/reproduce-locally/" class="">Reproduce CI environment locally</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/docs/archive-not-matching-git/" class="">Generated code in upstream archives</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-de9f4fbe058a823cefbf9e39a42e3770" class="toggle"  />
    <label for="section-de9f4fbe058a823cefbf9e39a42e3770" class="flex justify-between">
      <a href="https://packit.dev/source-git/" class="">Source-git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/design/" class="">Source-git design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-cf8eff71d5f50a1f85c94ebde3d5a047" class="toggle"  />
    <label for="section-cf8eff71d5f50a1f85c94ebde3d5a047" class="flex justify-between">
      <a href="https://packit.dev/source-git/work-with-source-git/" class="">Working with source-git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/create-source-git/" class="">Create a source-git repo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/update-spec/" class="">Update a spec file</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/pull-upstream-fixes/" class="">Pull fixes from the upstream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/control-patch-generation/" class="">Controlling patch generation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/build-locally/" class="">Build current checkout locally</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/propose-to-dist-git/" class="">Propose your source-git content to dist-git</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/sync-from-dist-git/" class="">Sync back changes made in dist-git</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/source-git/work-with-source-git/fix-diverged-history/" class="">Diverged history</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a07783f405300745807d39eacf150420" class="toggle"  />
    <label for="section-a07783f405300745807d39eacf150420" class="flex justify-between">
      <a  class="">Blog Posts</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dc16c8ecaf6a88aee8b0f6c668b70499" class="toggle"  />
    <label for="section-dc16c8ecaf6a88aee8b0f6c668b70499" class="flex justify-between">
      <a  class="">Weekly Status</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/march-2023/" class="">Packit March 2023</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/february-2023/" class="">Packit February 2023</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/january-2023/" class="">Packit January 2023</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/2022/" class="">2022</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/2021/" class="">2021</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/2020/" class="">2020</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/weekly/2019/" class="">2019</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/2022-features/" class="">2022 for Packit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/pull-from-upstream/" class="">Automatic pulling of upstream releases to Fedora</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/testing-farm-triggering/" class="">Running tests with builds from another PR</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/fas-verification-automation/" class="">Automation of FAS verification in Packit Service</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/downstream-automation/" class="">Downstream automation is here</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/copr-srpms/" class="">Building SRPMs in Copr</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/2021-features/" class="">2021 for Packit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/2021-in-numbers/" class="">2021 in Numbers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/posts/fedora-eln/" class="">Working on the next major RHEL release, in your upstream repo</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-03ded75136420a051aef84f84237f006" class="toggle"  />
    <label for="section-03ded75136420a051aef84f84237f006" class="flex justify-between">
      <a href="https://packit.dev/development-docs/" class="">Development Documentation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/development-docs/creating-stream-9-repos/" class="">Creating CentOS Stream 9 source-git repositories</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://packit.dev/development-docs/patch-metadata/" class="">Source-git patch metadata</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://status.packit.dev" target="_blank" rel="noopener">
        Status page
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Actions</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#command-matrix">Command matrix</a>
      <ul>
        <li><a href="#syncing-the-release">Syncing the release</a></li>
        <li><a href="#creating-srpm">Creating SRPM</a></li>
      </ul>
    </li>
    <li><a href="#actions-details">Actions details</a>
      <ul>
        <li><a href="#create-archive"><code>create-archive</code></a></li>
        <li><a href="#fix-spec-file"><code>fix-spec-file</code></a></li>
        <li><a href="#environment-variables-set-by-packit">Environment variables set by packit</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="actions">
  Actions
  <a class="anchor" href="#actions">#</a>
</h1>
<p>You can probably find yourself in a situation where some part of the packit workflow needs to be
tweaked for your package.</p>
<p>Packit supports actions, which can be used to change the default implementation
of some steps in the workflow. Packit is able to execute multiple
commands for a single action. Each action accepts a list of commands. By
default, the commands are executed using python&rsquo;s
<a href="https://docs.python.org/3/library/subprocess.html">subprocess</a> module without
shell. If you need a shell (e.g. you want to utilize an environment variable,
subprocesses, pipelines, expansion or any shell syntax in your command), just
wrap your command in a bash process:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash -c <span style="color:#e6db74">&#34;my fancy </span>$command<span style="color:#e6db74"> | grep success&#34;</span>
</span></span></code></pre></div><blockquote>
<p>It&rsquo;s important to quote the content of the <code>-c</code> option so shell interprets it
correctly as a single option input.</p>
</blockquote>
<p>All actions are also executed inside Packit Service. The service
creates a new sandbox environment where the command is run.</p>
<p>Actions have a default behaviour which you can override, hooks don&rsquo;t have any -
hooks are a way for you to perform operations following a certain packit event,
e.g. cloning an upstream repo.</p>
<p>Currently, these are the actions you can use:</p>
<h2 id="command-matrix">
  Command matrix
  <a class="anchor" href="#command-matrix">#</a>
</h2>
<h3 id="syncing-the-release">
  Syncing the release
  <a class="anchor" href="#syncing-the-release">#</a>
</h3>
<p>These apply to <code>propose-downstream</code> command/job and <code>pull-from-upstream</code> job.</p>
<table>
<thead>
<tr>
<th></th>
<th>name</th>
<th>working directory</th>
<th>when run</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[hook]</td>
<td><code>post-upstream-clone</code></td>
<td>upstream git repo</td>
<td>after cloning of the upstream repo (main) and before other operations</td>
<td></td>
</tr>
<tr>
<td>[hook]</td>
<td><code>pre-sync</code></td>
<td>upstream git repo</td>
<td>after cloning and checkout to the correct (release) branch</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>prepare-files</code></td>
<td>upstream git repo</td>
<td>after cloning, checking out of both upstream and dist-git repos</td>
<td>replace patching and archive generation</td>
</tr>
<tr>
<td></td>
<td><code>create-patches</code></td>
<td>upstream git repo</td>
<td>after sync of upstream files to the downstream</td>
<td>replace patching</td>
</tr>
<tr>
<td></td>
<td><code>get-current-version</code></td>
<td>upstream git repo</td>
<td>when the current version needs to be found</td>
<td>expect version as a stdout parameter</td>
</tr>
<tr>
<td></td>
<td><code>changelog-entry</code></td>
<td>upstream git repo</td>
<td>when adding a new changelog entry to the specfile</td>
<td>stdout is used as a changelog entry</td>
</tr>
</tbody>
</table>
<h3 id="creating-srpm">
  Creating SRPM
  <a class="anchor" href="#creating-srpm">#</a>
</h3>
<p>These apply to the <code>srpm</code> command and building in COPR.</p>
<table>
<thead>
<tr>
<th></th>
<th>name</th>
<th>working directory</th>
<th>when run</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[hook]</td>
<td><code>post-upstream-clone</code></td>
<td>upstream git repo</td>
<td>after cloning of the upstream repo (main) and before other operations</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>get-current-version</code></td>
<td>upstream git repo</td>
<td>when the current version needs to be found</td>
<td>expect version as a stdout</td>
</tr>
<tr>
<td></td>
<td><code>create-archive</code></td>
<td>upstream git repo</td>
<td>when the archive needs to be created</td>
<td>replace the code for creating an archive</td>
</tr>
<tr>
<td></td>
<td><code>create-patches</code></td>
<td>upstream git repo</td>
<td>after sync of upstream files to the downstream</td>
<td>replace patching</td>
</tr>
<tr>
<td></td>
<td><code>fix-spec-file</code></td>
<td>upstream git repo</td>
<td>after creation of a tarball and before running rpmbuild command</td>
<td>this action changes spec file to use the new tarball</td>
</tr>
<tr>
<td></td>
<td><code>changelog-entry</code></td>
<td>upstream git repo</td>
<td>when adding a new changelog entry to the specfile</td>
<td>stdout is used as a changelog entry</td>
</tr>
</tbody>
</table>
<h2 id="actions-details">
  Actions details
  <a class="anchor" href="#actions-details">#</a>
</h2>
<p>All actions are executed in a locked-down OpenShift pod. Your commands are
invoked with arbitrary UIDs from a high range. Some tools may experience
problems with these UIDs, such as <code>tar</code>. You can observe an error like this:</p>
<pre tabindex="0"><code>tar: value 1021440000 out of uid_t range 0..2097151
tar: Exiting with failure status due to previous errors
</code></pre><p>For <code>tar</code>, it&rsquo;s <a href="https://github.com/packit/packit.dev/issues/192#issuecomment-729594207">recommended</a>
to use the <code>pax</code> format (<code>tar -H pax</code>).</p>
<p>If you run into similar issues with other tools, please consult documentation or maintainers of the project.</p>
<h3 id="create-archive">
  <code>create-archive</code>
  <a class="anchor" href="#create-archive">#</a>
</h3>
<p>It is expected to return a relative path within the repository to the generated
archive. If there are more steps, then one of them has to return the archive
name. The best practice is to do it from the last step and print it: <code>bash -c 'echo path/to/archive-$VERSION.tar.gz'</code>.</p>
<p>If you can, please place the generated archive in the same directory as your
spec file.</p>
<p>If your project uses multiple archives, you should handle manipulation of your
spec file yourself in the <code>fix-spec-file</code> action. You also have to put all the
archives (spec file sources) in the same directory as your spec file.  Packit
expects that project only have a single archive set as <code>Source0</code> — it does not
have a mechanism to manipulate more sources right now.</p>
<h3 id="fix-spec-file">
  <code>fix-spec-file</code>
  <a class="anchor" href="#fix-spec-file">#</a>
</h3>
<p>By default, this action updates the spec file so it&rsquo;s possible to have a proper
reference of the archive in the <code>%prep</code> section and unpack it during the build
properly. The action tries to perform 3 operations on a spec file:</p>
<ol>
<li>
<p>It replaces Source configured by
<a href="/docs/configuration/#spec_source_id"><code>spec_source_id</code></a> (default <code>Source0</code>)
with a local path to the generated archive.</p>
</li>
<li>
<p>It changes the first <code>%setup</code> (or <code>%autosetup</code>) macro in <code>%prep</code> and adds
<code>-n</code> so the generated tarball can be unpacked (it tries to extract the
directory name directly from the archive or uses the configured
<a href="/docs/configuration#archive_root_dir_template"><code>archive_root_dir_template</code></a>).</p>
</li>
<li>
<p>It updates Version and Release in the spec file.</p>
</li>
</ol>
<p>If you provide your own implementation, none of the above happens.</p>
<p>For example a package may define multiple Sources. In such a case, the default
implementation of <code>fix-spec-file</code> won&rsquo;t be able to update <code>%prep</code> correctly.
You can instead use the <code>sed</code> program to set the new Sources correctly, e.g.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">actions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fix-spec-file</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># define one of the Source variables correctly</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">sed -i my_specfile_path -e &#34;s/https.*only-vendor.tar.xz/my_correct_tarball_path/&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># fill in Release as if packit would have done it</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">bash -c &#34;sed -i -r \&#34;s/Release:(\s*)\S+/Release:\1${PACKIT_RPMSPEC_RELEASE}%{?dist}/\&#34; my_specfile_path&#34;</span>
</span></span></code></pre></div><h3 id="environment-variables-set-by-packit">
  Environment variables set by packit
  <a class="anchor" href="#environment-variables-set-by-packit">#</a>
</h3>
<p>Additionally, packit sets a few env vars for specific actions.</p>
<p><strong>fix-spec-file</strong></p>
<p><code>PACKIT_PROJECT_VERSION</code> — current version of the project (coming from <code>git describe</code>)<br>
<code>PACKIT_PROJECT_COMMIT</code> — commit hash of the top commit<br>
<code>PACKIT_PROJECT_ARCHIVE</code> — expected name of the archive<br>
<code>PACKIT_RPMSPEC_RELEASE</code> — value for spec file&rsquo;s <code>%release</code> field which packit would set</p>
<p><strong>create-archive</strong></p>
<p><code>PACKIT_PROJECT_VERSION</code> — current version of the project (coming from <code>git describe</code>)
<code>PACKIT_PROJECT_NAME_VERSION</code> — current name and version of the project (coming from <code>git describe</code>)</p>
<p><strong>changelog-entry</strong></p>
<p><code>PACKIT_PROJECT_VERSION</code> — version to be set in the specfile, set when relevant
(e.g. when syncing upstream release downstream)</p>
<p>If you want to see the content of those variables, you can print using <code>echo</code>
in the specific action:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">actions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fix-spec-file</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">bash -c &#34;echo PACKIT_PROJECT_VERSION=${PACKIT_PROJECT_VERSION}&#34;</span>
</span></span></code></pre></div><p>and then make sure to run <code>packit</code> with the <code>--debug</code> option:</p>
<pre tabindex="0"><code>$ packit --debug srpm
...
2021-09-15 09:01:36.821 commands.py       DEBUG  Command: bash -c echo PACKIT_PROJECT_VERSION=${PACKIT_PROJECT_VERSION}
2021-09-15 09:01:36.826 logging.py        INFO   PACKIT_PROJECT_VERSION=0.14.0
</code></pre><hr>
<p>Actions can be defined like this in your <code>.packit.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">specfile_path</span>: <span style="color:#ae81ff">package.spec</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">files_to_sync</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">packit.yaml</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">package.spec</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">upstream_package_name</span>: <span style="color:#ae81ff">package</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">downstream_package_name</span>: <span style="color:#ae81ff">package</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">dist_git_url</span>: <span style="color:#ae81ff">https://src.fedoraproject.org/rpms/package.git</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">actions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">prepare-files</span>: <span style="color:#e6db74">&#34;make prepare&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create-archive</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#e6db74">&#34;make archive&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">bash -c &#34;ls -1 ./package-*.tar.gz&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">changelog-entry</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">echo &#34;New release ${PACKIT_PROJECT_VERSION}&#34;</span>
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#command-matrix">Command matrix</a>
      <ul>
        <li><a href="#syncing-the-release">Syncing the release</a></li>
        <li><a href="#creating-srpm">Creating SRPM</a></li>
      </ul>
    </li>
    <li><a href="#actions-details">Actions details</a>
      <ul>
        <li><a href="#create-archive"><code>create-archive</code></a></li>
        <li><a href="#fix-spec-file"><code>fix-spec-file</code></a></li>
        <li><a href="#environment-variables-set-by-packit">Environment variables set by packit</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












